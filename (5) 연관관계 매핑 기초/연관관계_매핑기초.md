객체는 참조(주소)를 사용해서 관계를 맺고 테이블은 외래 키를 사용해서 관계를 맺는다.     
이 둘은 완전히 다른 특징을 가지고 객체 관계 매핑에서 가장 어려운 부분이 객체 연관관계와 테이블 연관관계를 매핑하는 일이다.    

<br />      

* 방향(Direction) : [단방향, 양방향]이 있다.        
예를 들어 회원과 팀이 관계가 있을 때 회원 -> 팀 또는 팀 -> 회원 둘 중 한 쪽만 참조하는 것을 단방향 관계       
팀 -> 회원, 회원 -> 팀 양쪽 서로 참조하는 것을 양방향 관계라 한다.     
방향은 객체관계에만 존재하고 테이블 관계는 항상 양방향이다.

<br />     

* 다중성(Multiplicity) : [다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M)] 다중성이 있다.      
예를 들어 회원과 팀이 관계가 있을 때 여러 회원은 한 팀에 속하므로 회원과 팀은 다대일 관계다.      
반대로 한 팀에 여러 회원이 소속될 수 있으므로 팀과 회원은 일대다 관계다.

<br />     

* 연관관계의 주인(owner) : 객체를 양방향 연관관계로 만들면 연관관계의 주인을 정해야 한다.    



<br />     


# 1. 단방향 연관관계    
회원과 팀의 관계를 통해 다대일 단방향 관계를 알아보자.   

* 회원과 팀이 있다.     
* 회원은 하나의 팀에만 소속될 수 있다.     
* 회원과 팀은 다대일 관계다.     
<br />   

```
@Entity
public class Member {

    @Id
    @Column(name = "MEMBER_ID")
    private Long id;

    private String username;

    //연관 관계 매핑
    @ManyToOne
    @JoinColumn(name="TEAM_ID")
    private Team team;

    //연관관계 설정
    public void setTeam(Team team) {
        this.team = team;
    }

}
```

<br />      

**객체 연관관계**    
회원 객체와 팀 객체는 단반향 관계다.    
회원은 Member.team 필드를 통해 팀을 알 수 있지만 반대로 팀은 회원을 알 수 없다.   
<br />

**테이블 연관관계**      
회원 테이블과 팀 테이블은 양방향 관계다.       
회원 테이블의 TEAM_ID 외래 키를 통해서 회원과 팀을 조인할 수 있고 반대로 팀과 회원도 조인할 수 있다.     

다음은 회원과 팀을 조인하는 SQL이다.  
```
SELECT * 
FROM MEMBER M 
JOIN TEAM T ON M.TEAM_ID = T.ID

SELECT * 
FORM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
```
<br />    

**객체 연관관계와 테이블 연관관계의 가장 큰 차이**    
참조를 통한 연관관계는 언제나 단방향이다. 객체간에 연관관계를 양방향으로 만들고 싶으면 반대쪽에도 필드를 추가해서 참조를 보관해야 한다.    
하지만 정확히 이야기하면 이것은 양방향 관계가 아니라 서로 다른 단방향 관계 2개다.   
반면 테이블은 외래 키 하나로 양방향으로 조인할 수 있다.   

<br />      

### 1.1 순수한 객체 연관관계
```
Team findTeam = member1.getTeam();
```

객체는 참조를 사용해서 연관관계를 탐색할 수 있는데 이것을 객체 그래프 탐색이라고 한다.      

<br />    

### 1.2 객체 관계 매핑                 
* `@ManyToOne`              
    - 다대일(N:1) 관계라는 매핑 정보              
    - 어노테이션 필수              

* `@JoinColumn(name="TEAM_ID")`                  
    - 조인컬럼은 외래 키를 매핑할 때 사용                
    - name 속성에 매핑할 외래 키 이름을 지정                     
    - 생략 가능하다.       
    - 기본 전략 : 필드명 + _ + 참조하는 테이블의 컬러명      
    - 외래키 = team_TEAM_ID      

<br />            

### 1.3 `@ManyToOne`    
`@ManyToOne` 어노테이션은 다대일 관계에서 사용한다.    

```
@OneToMany
private List<Member> members;           // 제너릭 사용

@OneToMany(targetEntity=Member.class)   // 거의 사용 안함
private List members;                   // 타입 알 수 없음.
```

<br />                   

# 2. 연관관계 사용     
연관관계를 등록, 수정, 삭제, 조회하는 예제를 통해 연관관계를 어떻게 사용하는지 알아보자.           

### 2.1 저장    
**JPA에서 엔티티를 저장할 때 연관된 모든 엔티티는 영속 상태여야 한다.**    

```
member1.setTeam(team1);     //연관관계 설정 member1 -> team1
em.persist(member1);
```






